<ion-view class="task">
    <ion-content class="has-header">
        <ion-refresher
            pulling-text="Оновити інформацію..."
            on-refresh="vm.doRefresh()">
        </ion-refresher>
        <div class="result" ng-if="vm.task.done" ng-cloak="">
            <h2 class="title">Завдання виконано</h2>
        </div>
        <div class="list" ng-if="vm.task">
            <div class="photos" ng-if="vm.task.files.length">
                <img ng-src="{{ file.url }}"
                     alt="image"
                     ng-repeat="file in vm.task.files" ng-if="$index < 1">
            </div>
            <p class="explanation" align="center">
                {{ vm.task.explanation }}
            </p>
        </div>

        <div layout="row" layout-align="end center" flex>
            <md-button class="md-raised md-primary" ng-click="answerModal.show()">
                <md-icon md-font-icon="fa fa-pencil fa-lg" aria-hidden="true"></md-icon>
                Відправити відповідь
            </md-button>
        </div>


        <md-card>
            <div class="messages">
                <div ng-repeat="i in vm.messages">
                    <img
                        ng-src="{{i.id == 1 ? 'http://ecovoice.ru/uploads/images/e/8/c/7/3000/big/7b13345039.jpg':'https://rirl.ru/images/30754.jpg'}}"
                        alt="avatar" ng-class="{'my': i.id == 1, 'not-my': i.id ==2}"/>
                    <div class="message" ng-class="{'my': i.id == 1, 'not-my': i.id ==2}">
                        {{ i.text }}
                    </div>
                    <div style="clear: both"></div>
                </div>
            </div>

            <form novalidate="" name="questionForm" class="questionForm">
                <md-input-container class="md-block" flex>
                    <label>{{ vm.label.result }}</label>
                    <textarea name="question"
                              md-maxlength="150"
                              rows="3"
                              md-select-on-focus
                              ng-model="vm.data.text"
                              autocomplete="off"
                              required> </textarea>
                    <div ng-messages="questionForm.question.$error">
                        <div ng-message="required">Это поле обязательное для заполнения</div>
                    </div>
                </md-input-container>
                <div class="md-block send-button">
                    <div class="submit-button">
                        <md-button class="md-raised md-primary" ng-click="vm.submit()">
                            Задати питання
                        </md-button>
                    </div>
                </div>
            </form>
        </md-card>

        <!--<p class="tutor-text">Виникли запитання? Зверніться до репетитора</p>
        <form class="ask-form" ng-click="vm.question()">
            <div layout-gt-sm="row">
                <img src="../../../img/fox.png" class="fox">
                <md-card class="ask-card">
                    <md-input-container class="md-block" flex-gt-md>
                        <label>{{ vm.label.result }}</label>
                        <textarea name="ask"
                                  rows="3"
                                  md-select-on-focus
                                  type="text"
                                  ng-model="vm.data.ask"
                                  autocomplete="off"
                                  required
                                  disabled> </textarea>
                    </md-input-container>
                    <md-input-container class="md-block send-button">
                        <i class="fa fa-camera fa-2x photo"></i>
                        <i class="fa fa-file-audio-o fa-2x audio"></i>
                        <md-button class="right md-raised md-primary submit-button" ng-click="vm.question()" disabled>
                            Send
                        </md-button>
                    </md-input-container>
                </md-card>
            </div>
        </form>-->
    </ion-content>
</ion-view>
<script id="modal-answer.html" type="text/ng-template">
    <ion-modal-view class="task answerModal" >
        <ion-header-bar>
            <h1 class="title">Відправити відповідь</h1>
            <div class="buttons">
                <button class="button button-icon button-clear ion-close-circled" ng-click="answerModal.hide()">
                </button>
            </div>
        </ion-header-bar>
        <ion-content>
            <md-card class="answer">
                <form novalidate="" name="answerForm" class="fade-element-in">
                    <md-input-container class="md-block" flex>
                    <textarea name="answer"
                              md-maxlength="150"
                              rows="8"
                              md-select-on-focus
                              placeholder="{{ vm.label.result }}"
                              type="text"
                              ng-model="vm.data.answer"
                              autocomplete="off"
                              required> </textarea>
                        <div ng-messages="answerForm.answer.$error" ng-if="answerForm.answer.$touched">
                            <div ng-message="required">Это поле обязательное для заполнения</div>
                        </div>
                    </md-input-container>

                    <div class="md-block" layout="row">
                        <div layout-align="start center" flex>
                            <md-button class="photo md-icon-button md-fab md-mini md-hue-2"
                                       ng-style="{'background-color': '#1E88E5'}"
                                       ngf-multiple="true"
                                       ngf-max-files="5"
                                       ngf-select="vm.upload($files)"
                                       accept="image/*">
                                <md-icon md-font-icon="fa fa-camera fa-lg" aria-hidden="true"></md-icon>
                            </md-button>
                            <md-button class="md-icon-button md-fab md-mini md-hue-2"
                                       ng-if="vm.audio"
                                       ng-style="{'background-color': '#1E88E5'}"
                                       ng-click="vm.audio()">
                                <md-icon md-font-icon="fa fa-file-audio-o fa-lg"
                                         aria-hidden="true"></md-icon>
                            </md-button>
                        </div>

                        <div layout-align="end center" flex class="submit-button">
                            <md-button class="md-raised md-primary" ng-click="vm.submit()">
                                Відправити
                            </md-button>
                        </div>
                    </div>
                    <div class="md-block">
                        <img ng-src="img/spinner.gif"
                             ngf-thumbnail="file"
                             class="attach-image"
                             ng-repeat="file in vm.data.photo"
                             ng-click="showImages($index)"
                             ng-init="$last && vm.hideLoader()">
                    </div>
                </form>
            </md-card>
        </ion-content>
    </ion-modal-view>
</script>
